# Orchestrator

A minimal agent delegation framework that coordinates AI agents to implement features across codebases.

## What It Does

Orchestrator manages multi-phase development workflows by:

1. **Planning** - Analyzes requests and creates session files with phased execution plans
2. **Routing** - Delegates work to the correct specialist agents based on ownership rules
3. **Tracking** - Monitors progress through MCP session tools
4. **Validating** - Ensures builds pass before proposing commits

The orchestrator itself never writes code - it only coordinates agents that do.

## Architecture

```
┌─────────────────────────────────────────────────────────────────┐
│                      ORCHESTRATOR                                │
│  Skills: session-management, orchestrate-feature,               │
│          sub-agent-invocation, git-commits                       │
│  Agents: session-planner, finalize                               │
└─────────────────────────────────────────────────────────────────┘
                              │
                              │ spawns & coordinates
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│                    TARGET PROJECT                                │
│  Agents: api-agent, schema-agent, ui-agent, etc.                │
│  Skills: project-specific domain knowledge                       │
└─────────────────────────────────────────────────────────────────┘
```

## Requirements

- Python 3.11+
- Node.js 20+ (for Claude Code CLI)
- Claude API access (via `claude login`)

## Installation

```bash
git clone https://github.com/yourusername/orchestrator.git
cd orchestrator
pip install -r requirements.txt
```

## Usage

### Initialize a Project

```bash
# Analyzes .claude/agents/*.md files and generates AGENTS.md
./run.sh init /path/to/project
```

### Run Orchestration

```bash
# Resume or start orchestration
./run.sh /path/to/project

# Start fresh session (archives existing)
./run.sh new /path/to/project

# Check session status
./run.sh status /path/to/project
```

### Docker

```bash
# Same commands, containerized
./docker-run.sh init /path/to/project
./docker-run.sh /path/to/project
./docker-run.sh new /path/to/project
```

## Target Project Setup

Your target project needs a `.claude/` directory with agents defined:

```
your-project/
├── .claude/
│   ├── agents/
│   │   ├── AGENTS.md          # Generated by 'init'
│   │   ├── api-agent.md       # Your domain agents
│   │   ├── schema-agent.md
│   │   └── ui-agent.md
│   ├── skills/                 # Optional domain skills
│   │   └── your-skill/
│   │       └── SKILL.md
│   └── tasks/
│       └── session-current.md  # Created during orchestration
```

### Agent File Format

```markdown
---
name: api-agent
description: Creates and modifies API endpoints
---

You are the API Agent...

## Files I OWN:
- src/api/
- src/routes/

## Files I NEVER touch:
- src/db/
- src/ui/
```

## Session Flow

1. **User runs orchestrator** with a request
2. **Session planner** creates `session-current.md` with phases
3. **Orchestrator loop** spawns agents for each phase
4. **Agents** complete work and update session file
5. **Finalize agent** validates build and proposes commit
6. **Session archived** to `session-N.md`

## Session File Format

```markdown
# Session: Add user authentication

## Status
- Phase: 1 of 3
- Current Agent: schema-agent
- State: pending

## User Request
Add user authentication with JWT tokens

## Phases
1. [ ] schema-agent - Add User model with password hash
2. [ ] api-agent - Create auth endpoints
3. [ ] finalize - Validate and commit

## Work Log
(agents update this)
```

## Configuration

### Environment Variables

| Variable | Default | Description |
|----------|---------|-------------|
| `CLAUDE_MODEL` | `claude-opus-4-5-20251101` | Model to use |

### Files

| File | Purpose |
|------|---------|
| `prompts/orchestrator.md` | Main orchestrator prompt |
| `.claude/agents/` | Orchestrator's own agents |
| `.claude/skills/` | Orchestrator's operating skills |

## How It Works

### MCP Session Tools

The orchestrator uses MCP (Model Context Protocol) to manage sessions:

- `session_get_status` - Get current phase and state
- `session_get_next_phase` - Get next incomplete phase
- `session_mark_phase_complete` - Mark phase done
- `session_is_complete` - Check if all phases done

### Skills

Skills provide domain knowledge:

| Skill | Purpose |
|-------|---------|
| `session-management` | Session file format, MCP tools |
| `orchestrate-feature` | Routing and delegation patterns |
| `sub-agent-invocation` | How to spawn agents properly |
| `git-commits` | Commit formatting (requires human approval) |

## License

MIT License - see [LICENSE](LICENSE)
